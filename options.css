/* =====================================================
 * SummarizerX Options — Flat UI Theme (Vue-ready)
 * - Keep existing class names and DOM structure
 * - Remove glassmorphism, blurs, heavy shadows, and gradients
 * - Use solid surfaces, crisp borders, clear focus rings
 * - Maintain responsive behavior and no unintended line breaks
 * ===================================================== */

* { box-sizing: border-box; }
html, body { height: 100%; }

:root{
  /* Base palette — light */
  --bg: #f7f8fb;
  --surface: #ffffff;
  --surface-2: #f2f4f8;
  --border: #e5e7eb;
  --text: #111827;
  --muted: #606b85;

  --primary: #2563eb;     /* brand blue */
  --primary-600: #1e40af; /* darker */
  --accent: #10b981;      /* success */
  --danger: #dc2626;      /* error */
  --link: #2563eb;
  --candy-az: rgba(59,130,246,.10);
  --candy-vi: rgba(99,102,241,.10);
  --glass: rgba(255,255,255,.72);
  --glass-soft: rgba(255,255,255,.48);
  --card-glass: rgba(255,255,255,.82);
  --card-glass-soft: rgba(255,255,255,.68);

  --radius: 12px;
  --ring: 0 0 0 3px rgba(37,99,235,.20);

  --dock-h: 76px; /* save dock height */
}

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC", "Noto Sans SC", sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* =========================
 * Language switch transition (soft cross-fade)
 * ========================= */
html.lang-anim .hero,
html.lang-anim .main-with-dock,
html.lang-anim .save-dock{
  transition: opacity .22s ease, transform .22s ease;
}

/* =========================
 * Page open animations (subtle and respectful)
 * ========================= */
@keyframes optFadeInUp {
  0%   { opacity: 0; transform: translateY(8px) scale(.985); filter: blur(3px); }
  60%  { opacity: .96; transform: translateY(0)   scale(1);    filter: blur(1px); }
  100% { opacity: 1; transform: translateY(0)   scale(1);    filter: blur(0); }
}
@keyframes optFadeInDown {
  0%   { opacity: 0; transform: translateY(-6px) scale(.99); filter: blur(2px); }
  100% { opacity: 1; transform: translateY(0)    scale(1);   filter: blur(0); }
}

html.page-enter .hero{ animation: optFadeInDown .48s cubic-bezier(.2,.7,.3,1) both; }
html.page-enter .section.card.fx-in{ animation: optFadeInUp .46s cubic-bezier(.2,.7,.3,1) both; }
html.page-enter .save-dock{ animation: optFadeInUp .40s ease .08s both; }

@media (prefers-reduced-motion: reduce){
  html.page-enter .hero,
  html.page-enter .section.card.fx-in,
  html.page-enter .save-dock{ animation: none; }
}
html.lang-anim.lang-out .hero,
html.lang-anim.lang-out .main-with-dock,
html.lang-anim.lang-out .save-dock{
  opacity: 0;
  transform: translateY(4px);
  pointer-events: none;
}
@media (prefers-reduced-motion: reduce){
  html.lang-anim .hero,
  html.lang-anim .main-with-dock,
  html.lang-anim .save-dock{ transition: none; }
}

/* 内容避免被底栏遮挡 */
.main-with-dock{ padding-bottom: var(--dock-h); }
.wrap{ max-width: 980px; margin: 0 auto; padding: 0 16px; }

/* Toast */
#sx-toast-root{ position: fixed; right: 16px; bottom: 16px; z-index: 2147483000; display:flex; flex-direction: column; gap:8px; }
.sx-toast{
  min-width: 200px; max-width: 360px;
  padding: 10px 12px; border-radius: var(--radius);
  background: #0f172a; color:#f8fafc; border:1px solid rgba(255,255,255,0.08);
  font-size: 13px; line-height: 1.5;
}
.sx-toast.success{ background:#059669; }
.sx-toast.error{ background:#b91c1c; }
[data-theme="light"] .sx-toast{ background:#0f172a; color:#f8fafc; }

/* =========================
 * Page header (flat card)
 * ========================= */
.hero{
  position: relative;
  background:
    linear-gradient(90deg, var(--candy-vi) 0%, var(--candy-az) 55%, rgba(255,255,255,0) 100%),
    linear-gradient(180deg, var(--glass) 0%, var(--glass-soft) 100%);
  -webkit-backdrop-filter: blur(12px) saturate(1.05);
  backdrop-filter: blur(12px) saturate(1.05);
  border: 1px solid var(--border);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  padding: 20px 0 16px;
  margin: 0 0 16px;
  box-shadow: 0 2px 10px rgba(16,24,40,.06);
}

.hero-header{
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 20px;
}

.hero-title{
  margin:0;
  font-size:22px;
  font-weight:800;
  letter-spacing:.3px;
  display:flex; align-items:center; gap:10px;
  flex: 1;
}

.hero-sub{ margin:6px 0 0; color:#6b7280; font-size:13px; }
.badge{
  font-size:12px; color:#3730a3; background:#eef2ff; border:1px solid #c7d2fe;
  padding:3px 8px; border-radius:999px;
}

/* Language switcher — segmented */
.language-switcher{ display:flex; gap:4px; background: var(--surface-2); border:1px solid var(--border); border-radius: 8px; padding: 2px; }
.lang-btn{
  background: transparent; border: none; padding: 6px 12px; border-radius: 6px;
  font-size: 12px; font-weight: 600; color: var(--muted); cursor: pointer; transition: background .15s, color .15s;
  white-space: nowrap;
}
.lang-btn:hover{ background:#eaeef6; color:#0f172a; }
.lang-btn.active{ background:#1f2937; color:#fff; }

/* =========================
 * Section cards (flat)
 * ========================= */
.section.card{
  position: relative;
  background:
    radial-gradient(160px 120px at 24px -24px, rgba(255,255,255,.35) 0%, rgba(255,255,255,0) 68%),
    linear-gradient(180deg, var(--card-glass) 0%, var(--card-glass-soft) 100%);
  -webkit-backdrop-filter: blur(8px) saturate(1.05);
  backdrop-filter: blur(8px) saturate(1.05);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin: 16px 0;
  transition: transform .15s ease, box-shadow .22s ease, border-color .2s ease, background-color .2s ease;
  will-change: transform, box-shadow;
  box-shadow: 0 1px 1px rgba(16,24,40,.05), 0 8px 22px rgba(16,24,40,.08);
}

/* Light mode: add a gentle tint so cards aren't pure white */
html[data-theme="light"] .section.card{
  background:
    radial-gradient(160px 120px at 24px -24px, rgba(255,255,255,.35) 0%, rgba(255,255,255,0) 68%),
    linear-gradient(90deg, var(--candy-vi) 0%, var(--candy-az) 60%, rgba(255,255,255,0) 100%),
    linear-gradient(180deg, var(--card-glass) 0%, var(--card-glass-soft) 100%);
}
.section-title{ margin:0 0 12px; font-size:16px; font-weight:700; color: var(--text); display:flex; align-items:center; gap:8px; }
.section-title .dot{ width:8px; height:8px; border-radius:50%; background: var(--primary); display:inline-block; }
.section.card.note .section-title .dot{ background: var(--accent); }

/* =========================
 * Form layout
 * ========================= */
.grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
@media (max-width: 800px){ .grid{ grid-template-columns:1fr; } }

.field{ display:block; }
.label{ display:flex; align-items:center; gap:6px; font-size:12px; color:#475467; font-weight:600; margin:0 0 6px; }
.label .icon{ color:#2563eb; flex-shrink:0; }

/* Inputs */
.ctrl{
  width:100%; padding:10px 12px; border-radius: 10px; font-size:14px; outline:none; transition: box-shadow .15s, border-color .15s, background .15s;
  background:#fff; border:1px solid #d1d5db; color: var(--text);
}
.ctrl::placeholder{ color:#9aa3b2; }

/* Improve select dropdown affordance and spacing for arrow */
select.ctrl{
  -webkit-appearance: none; appearance: none;
  padding-right: 38px; /* leave room for chevron */
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 12px 12px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%235b667a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
}
html[data-theme="dark"] select.ctrl{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23dbe3ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
}
.ctrl::placeholder{ color:#9aa3b2; }
.ctrl:hover{ border-color:#cbd5e1; }
.ctrl:focus{ border-color:#93c5fd; box-shadow: var(--ring); }

/* Light mode — neutral buttons & segmented controls (Indigo primary) */
html[data-theme="light"] .btn{ background:#fff; border-color:#d7dbe6; color:#0f172a; }
html[data-theme="light"] .btn:hover{ background:#f4f6fb; border-color:#c9cedb; }
html[data-theme="light"] .btn:active{ background:#eef1f7; }
html[data-theme="light"] .btn.primary{ background: var(--primary); border-color: var(--primary); color:#fff; }
html[data-theme="light"] .btn.primary:hover{ background: var(--primary-600); border-color: var(--primary-600); }

html[data-theme="light"] .save-dock .btn{ background:#fff; border-color:#d7dbe6; color:#0f172a; } /* 确保非主按钮文字为深色 */
html[data-theme="light"] .save-dock .btn:hover{ background:#f4f6fb; border-color:#c9cedb; }
html[data-theme="light"] .save-dock .btn.primary{ background: var(--primary); border-color: var(--primary); color:#fff; } /* 主按钮白字 */

html[data-theme="light"] .language-switcher{ background: var(--surface-2); border-color: var(--border); }
html[data-theme="light"] .language-switcher .lang-btn{ color:#334155; }
html[data-theme="light"] .language-switcher .lang-btn:hover{ background:#eef1f7; color:#0f172a; }
html[data-theme="light"] .language-switcher .lang-btn.active{ background: var(--primary); color:#fff; }

.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; line-height:1.6; min-height:160px; }

/* Password eye */
.eye-wrap{ position: relative; }
.eye-wrap input.ctrl{ padding-right: 44px; }

.eye-btn{ position:absolute; right:10px; top:50%; transform: translateY(-50%); width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; border:0; background:transparent; color:#6b7280; cursor:pointer; border-radius:6px; }
.eye-btn:hover{ background:#edf2f7; color:#1e40af; }
.eye-btn:focus-visible{ outline:2px solid var(--primary); }

/* Eye state sync — no JS changes needed
   If you render two icons inside the button: .icon-eye-open and .icon-eye-closed,
   we will auto toggle by the input type. Also provide a fallback slash if there is only one icon. */

/* Prefer explicit icons if present */
.eye-wrap:has(input[type="password"]) .eye-btn .icon-eye-open{ display:none !important; }
.eye-wrap:has(input[type="password"]) .eye-btn .icon-eye-closed{ display:inline !important; }
.eye-wrap:has(input[type="text"]) .eye-btn .icon-eye-open{ display:inline !important; }
.eye-wrap:has(input[type="text"]) .eye-btn .icon-eye-closed{ display:none !important; }

/* Fallback: draw a "slash" when hidden (type=password), in case only one icon exists */
.eye-wrap:has(input[type="password"]) .eye-btn::after{
  content:""; position:absolute; inset:0; pointer-events:none;
  width: 22px; height: 2px; margin:auto; border-radius:2px; opacity:.92;
  background: currentColor; transform: rotate(-40deg);
}
/* Slightly lift visual weight on hover/focus for accessibility */
.eye-wrap:has(input[type="password"]) .eye-btn:hover::after,
.eye-wrap:has(input[type="password"]) .eye-btn:focus-visible::after{ opacity:1; }

/* Disabled */
.ctrl[disabled]{ background:#f3f4f6; color:#9aa3b2; cursor:not-allowed; }
.eye-btn:disabled{ opacity:.4; cursor:not-allowed; }

/* =========================
 * Buttons (flat)
 * ========================= */
.row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.btn{
  padding:10px 14px; border-radius: 10px; cursor:pointer; font-weight:700; border:1px solid #d1d5db; background:#fff; color:#111827; transition: background .15s, border-color .15s, transform .05s;
  white-space: nowrap; min-width:0; flex-shrink:1; max-width:160px; overflow:hidden; text-overflow:ellipsis;
}
.btn:hover{ background:#f3f4f6; border-color:#cbd5e1; }
.btn:active{ transform: translateY(1px); }
.btn.primary{ background: var(--primary); border-color: var(--primary); color:#fff; }
.btn.primary:hover{ background:#1d4ed8; border-color:#1d4ed8; }

/* Helper/notes */
.help{
  position:relative;
  font-size:13px;
  color:#374151; /* clearer text on light */
  line-height:1.7;
  padding:12px 14px;
  border-radius:12px;
  /* warm subtle amber tint + recessed glass */
  border:1px solid #f3e9c5;
  background:
    linear-gradient(180deg, rgba(255, 245, 200, .64) 0%, rgba(255, 250, 220, .90) 100%),
    #fffef8;
  -webkit-backdrop-filter: blur(5px) saturate(1.04);
  backdrop-filter: blur(5px) saturate(1.04);
  /* recessed (pressed-in) bevel: darker inner top + lighter inner bottom */
  box-shadow:
    inset 0 1px 0 rgba(245, 200, 120, .24),
    inset 0 -1px 0 rgba(255,255,255,.78),
    inset 1px 0 0 rgba(245,200,120,.12),
    inset -1px 0 0 rgba(255,255,255,.40);
}
.consent-attn .help{
  /* Light theme: pale yellow background + red frame pulse */
  border-color: #ef4444; /* red-500 (frame + border emphasis) */
  background:
    linear-gradient(180deg, rgba(255, 251, 235, .92) 0%, rgba(254, 243, 199, .98) 100%),
    #fffbeb; /* pale yellow */
  animation: consentPulse 1.2s ease-in-out 3;
}
/* Ensure same specificity as dark variant so light mode always animates */
html[data-theme="light"] .consent-attn .help{
  animation: consentPulse 1.2s ease-in-out 3;
}
/* Dark theme variant: stronger contrast with deep tints */
html[data-theme="dark"] .consent-attn .help{
  border-color: #fb7185; /* rose-400 */
  background:
    linear-gradient(180deg, rgba(127, 29, 29, .42) 0%, rgba(69, 10, 10, .62) 100%),
    #1b0f10; /* deep, slightly reddish base */
  color: #fde2e2; /* light rose text */
  animation: consentPulseDark 1.2s ease-in-out 3;
}
/* Emphasize the checkbox color while drawing attention */
.consent-attn input[type="checkbox"]{ accent-color: #ef4444; } /* red for light theme */
html[data-theme="dark"] .consent-attn input[type="checkbox"]{ accent-color: #fb7185; }
/* Replace default blue focus ring on the checkbox with a soft ring on the container */
.consent-attn input[type="checkbox"]:focus,
.consent-attn input[type="checkbox"]:focus-visible{
  outline: none !important;
  box-shadow: none !important;
}
.consent-attn .help{ position: relative; }
.consent-attn .help:focus-within{
  /* red focus ring in light */
  box-shadow: 0 0 0 3px rgba(239,68,68,.28);
}
html[data-theme="dark"] .consent-attn .help:focus-within{
  box-shadow: 0 0 0 4px rgba(251,113,133,.28);
}
@keyframes consentPulse{
  0% { box-shadow: 0 0 0 0 rgba(239,68,68,.35); }
  50%{ box-shadow: 0 0 0 6px rgba(239,68,68,.18); }
  100%{ box-shadow: 0 0 0 0 rgba(239,68,68,0); }
}
@keyframes consentPulseDark{
  0% { box-shadow: 0 0 0 0 rgba(251,113,133,.55); }
  50%{ box-shadow: 0 0 0 8px rgba(251,113,133,.22); }
  100%{ box-shadow: 0 0 0 0 rgba(251,113,133,0); }
}
.meta{ margin-top:8px; font-size:12px; color:#475467; border:1px dashed var(--border); background: #f7f8fb; padding:8px; border-radius:8px; }
.hint{ font-size:12px; color:#6b7280; }

/* Shortcuts */
.shortcut .shortcut-desc{ font-size: 13px; color:#555; margin: 6px 0 12px; }
html[data-theme="dark"] .shortcut .shortcut-desc{ color:#b6c0cf; }
.shortcut code{ background:#111827; color:#e5e7eb; padding:2px 6px; border-radius:6px; }

/* =========================
 * Save dock (flat)
 * ========================= */
.save-dock{
  position: fixed; left: 0; right: 0; bottom: 0; min-height: var(--dock-h);
  padding: 10px 0 12px;
  background:
    linear-gradient(90deg, var(--candy-vi) 0%, var(--candy-az) 55%, rgba(255,255,255,0) 100%),
    linear-gradient(180deg, var(--glass) 0%, var(--glass-soft) 100%);
  -webkit-backdrop-filter: blur(10px) saturate(1.05);
  backdrop-filter: blur(10px) saturate(1.05);
  border-top:1px solid var(--border);
  display:flex; align-items:center; z-index:50;
  box-shadow: 0 -1px 8px rgba(16,24,40,.08);
}
.dock-inner{ width:100%; display:flex; align-items:center; justify-content:space-between; gap:12px; }
.dock-left{ display:flex; flex-direction:column; gap:6px; min-width: 380px; max-width: 520px; flex-shrink:1; }
.dock-right{ display:flex; gap:10px; flex-wrap:nowrap; align-items:center; min-width:0; flex:1; justify-content:flex-end; }

.status-line{ display:flex; align-items:center; gap:8px; }
.status-dot{ width:8px; height:8px; border-radius:50%; background:#cbd5e1; }
.status-text{ font-size:12px; color:#64748b; }

.save-dock .meta{
  margin:0; max-width:100%; white-space:normal; word-break: break-word; overflow:auto; text-overflow:unset; max-height:9.1em; font-size:11px; line-height:1.3; padding:6px 8px;
}

/* Field sizing helpers */
.field-full { margin-bottom: 16px; }
select.ctrl.short{ max-width: 220px; height: 34px; line-height: 34px; padding: 0 34px 0 10px; background-position: right 10px center; }
#aiProvider.ctrl { max-width: 400px; display: inline-block; }
#dock-spacer { height: 12px; }

/* Purchase inline */
.buy-help-inline{ display:inline-block; margin-left:8px; font-size:12px; color:#6b7280; vertical-align:middle; white-space:nowrap; }
.buy-help-inline a{ color: var(--link); text-decoration: underline; text-underline-offset: 2px; margin: 0 2px; }
.buy-help-inline a:hover{ filter: brightness(0.95); }
@media (max-width: 800px){ .buy-help-inline{ display:block; margin:6px 0 0; white-space: normal; } }

/* Dark theme: brighten inline purchase helper text for readability */
html[data-theme="dark"] .buy-help-inline{ color:#cbd5e1; }

/* Utility */
.hidden { display: none !important; }

/* =========================
 * Theme toggle (flat)
 * ========================= */
.theme-toggle{ display:flex; align-items:center; gap:10px; min-height:40px; flex-shrink:0; }
.theme-toggle .label{ display:flex; align-items:center; justify-content:center; height:42px; line-height:42px; font-size:12px; font-weight:700; color:#475569; margin-right:2px; }
.theme-toggle .seg{ display:flex; align-items:center; gap:6px; background:#f4f6fb; border:1px solid #d9e4f5; border-radius: 999px; padding:4px; }
.theme-toggle .seg button, .theme-btn{ width:34px; height:34px; display:grid; place-items:center; border:none; border-radius:999px; cursor:pointer; background:transparent; color:#5b6b7f; padding:0; }
.theme-toggle .seg button.active,
.theme-toggle .seg button[aria-selected="true"],
.theme-btn.active,
.theme-btn[aria-selected="true"]{
  background: var(--primary);
  color:#fff;
}
.theme-toggle .seg button svg, .theme-btn svg{ width:18px; height:18px; pointer-events:none; stroke: currentColor; fill:none; opacity:.95; }

/* =========================
 * Responsive tweaks
 * ========================= */
@media (max-width: 720px){
  .dock-inner{ flex-direction: column; align-items: stretch; }
  .dock-left{ min-width:auto; max-width:none; }
  .dock-right{ justify-content:flex-end; gap:8px; flex-wrap: wrap; }
  .btn{ padding: 8px 12px; font-size:12px; max-width: 120px; }
  .save-dock .meta{ white-space:normal; font-size:10px; padding:4px 6px; }
}
.save-dock{ padding: 12px 0; }
.main-with-dock{ padding-bottom: 120px; }
.save-dock .status-line{ margin-top: 2px; }

/* =========================
 * Dark theme — explicit (html[data-theme="dark"]) flat
 * ========================= */
html[data-theme="dark"]{
  --bg:#0b1220;
  --surface:#111a2e;
  --surface-2:#0d1526;
  --border:#1f2a44;
  --text:#e7ebf3;
  --muted:#a3adc2;
  --primary:#8ea2ff;      /* indigo on dark */
  --primary-600:#7b8cff;
  --accent:#7dd3a7;
  --link:#a7b7ff;
  --candy-az: rgba(142,162,255,.14);
  --candy-vi: rgba(123,140,255,.12);
  --glass: rgba(17,26,46,.62);
  --glass-soft: rgba(17,26,46,.44);
  --card-glass: rgba(17,26,46,.78);
  --card-glass-soft: rgba(17,26,46,.60);
}

html[data-theme="dark"] .hero,
html[data-theme="dark"] .section.card,
html[data-theme="dark"] .save-dock{
  /* keep glass backgrounds; only ensure border tone */
  border-color: var(--border);
}
html[data-theme="dark"] .help{
  color:#e5ecf7;
  border-color:#2a3a57;
  background:
    linear-gradient(180deg, rgba(17,26,46,.62) 0%, rgba(17,26,46,.44) 100%),
    var(--surface-2);
  -webkit-backdrop-filter: blur(8px) saturate(1.05);
  backdrop-filter: blur(8px) saturate(1.05);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.28);
}
html[data-theme="dark"] .meta{ color:#b9c3d3; background: #101826; border-color: var(--border); }
html[data-theme="dark"] .hint{ color:#9fb0c6; }
/* Brighten form labels and headings for readability */
html[data-theme="dark"] .label{ color: var(--text); }
html[data-theme="dark"] .section-title{ color: var(--text); }
html[data-theme="dark"] .theme-toggle .label{ color: var(--text); }
/* Slightly brighter placeholders in dark */
html[data-theme="dark"] .ctrl::placeholder{ color:#b7c2d8; }
html[data-theme="dark"] .section-title .dot{ background: var(--primary-600); }
html[data-theme="dark"] .section.card.note .section-title .dot{ background: var(--accent); }
html[data-theme="dark"] .ctrl{ background:#0f172a; border-color:#2a3a57; color: var(--text); }
html[data-theme="dark"] .ctrl:hover{ border-color:#3a4f72; }
html[data-theme="dark"] .ctrl:focus{ border-color:#4d6b99; box-shadow: 0 0 0 3px rgba(159,184,216,0.22); }
html[data-theme="dark"] .theme-toggle .seg{ background:#1a2333; border-color:#2a3a57; }
html[data-theme="dark"] .theme-toggle .seg button{ color:#d7dde7; }
html[data-theme="dark"] .theme-toggle .seg button.active,
html[data-theme="dark"] .theme-toggle .seg button[aria-selected="true"],
html[data-theme="dark"] .theme-btn.active,
html[data-theme="dark"] .theme-btn[aria-selected="true"]{ background: var(--primary-600); color:#fff; }
html[data-theme="dark"] .language-switcher{ background:#1a2333; border-color:#2a3a57; }
html[data-theme="dark"] .language-switcher .lang-btn{ color:#e6e9ef; }
html[data-theme="dark"] .language-switcher .lang-btn:hover{ background:#24324a; color:#fff; }
html[data-theme="dark"] .language-switcher .lang-btn.active{ background: var(--primary-600); color:#fff; }
/* Re-apply custom chevron for selects in dark theme (background shorthand above clears it) */
html[data-theme="dark"] select.ctrl{
  -webkit-appearance: none; appearance: none;
  padding-right: 38px;
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 12px 12px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23dbe3ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
}

/* --- Dark mode refinements: shortcuts & buttons --- */
html[data-theme="dark"] .shortcut{
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px;
}

/* Dark theme: soften and enlarge the card highlight for a more natural look */
html[data-theme="dark"] .section.card{
  background:
    radial-gradient(220px 160px at 24px -24px, rgba(255,255,255,.10) 0%, rgba(255,255,255,0) 80%),
    linear-gradient(180deg, var(--card-glass) 0%, var(--card-glass-soft) 100%);
}

/* Ensure buttons in save dock and shortcuts also follow dark tone */
html[data-theme="dark"] .btn{
  background:#0e1726;            /* deeper, less bright */
  border-color:#27344b;
  color:#dbe3ee;                 /* lighten label for contrast */
}
html[data-theme="dark"] .btn:hover{ background:#142037; border-color:#344766; }
html[data-theme="dark"] .btn:active{ background:#101c30; }

html[data-theme="dark"] .save-dock .btn,
html[data-theme="dark"] .shortcut .btn{
  background:#0e1726;
  border-color:#27344b;
  color:#dbe3ee;
}
html[data-theme="dark"] .save-dock .btn:hover,
html[data-theme="dark"] .shortcut .btn:hover{ background:#142037; border-color:#344766; }

/* Primary buttons in dark mode */
html[data-theme="dark"] .btn.primary{
  background: var(--primary-600); /* softer than pure brand in dark */
  border-color: var(--primary-600);
  color:#fff;
}
html[data-theme="dark"] .btn.primary:hover{ background:#4a5f7a; border-color:#4a5f7a; }

/* =========================
 * Light theme — Indigo Neutral
 * ========================= */
html[data-theme="light"]{
  --bg:#ffffff;
  --surface:#ffffff;
  --surface-2:#f3f5f9;      /* neutral secondary */
  --border:#e6e9f2;         /* neutral border */
  --text:#0f172a;           /* deep slate */
  --muted:#5b667a;          /* secondary text */
  --primary:#6366f1;        /* indigo 500 */
  --primary-600:#4f46e5;    /* indigo 600 */
  --accent:#22c55e;         /* success green */
  --link:#6366f1;           /* link color */
  --card-bg:#f5f8ff;        /* subtle pastel blue for cards */
  --card-br:#dbe7ff;        /* matching soft blue border */
}

/* Surfaces: hero & dock 使用与卡片一致的淡蓝配色（更和谐） */
/* Light theme uses glass backgrounds defined above; keep borders if needed */
html[data-theme="light"] .hero,
html[data-theme="light"] .save-dock{ border-color: var(--card-br); }
html[data-theme="light"] .section.card{ border-color: var(--card-br); }

/* Card elevation — light theme */
html[data-theme="light"] .section.card:hover,
html[data-theme="light"] .section.card:focus-within{
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(37,99,235,0.07), 0 2px 6px rgba(16,24,40,0.05);
  border-color: var(--card-br);
}

/* Inputs */
html[data-theme="light"] .ctrl{ background:#fff; border-color:#d7dbe6; color: var(--text); }
html[data-theme="light"] .ctrl:hover{ border-color:#c9cedb; }
html[data-theme="light"] .ctrl:focus{ border-color:#aab2ff; box-shadow: 0 0 0 3px rgba(99,102,241,.18); }
/* Re-apply custom chevron for selects in light theme (background shorthand above clears it) */
html[data-theme="light"] select.ctrl{
  -webkit-appearance: none; appearance: none;
  padding-right: 38px;
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 12px 12px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%235b667a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
}

/* Headings & accents */
html[data-theme="light"] .section-title .dot{ background: var(--primary); }
html[data-theme="light"] .hero-sub{ color:#667085; }

/* Helper blocks */
html[data-theme="light"] .help{ background:#f3f5f9; border-color:#e6e9f2; color:#364152; }
html[data-theme="light"] .meta{ background:#f6f7fb; border-color:#e6e9f2; color:#475467; }

/* =========================
 * Card elevation — dark theme
 * ========================= */
html[data-theme="dark"] .section.card:hover,
html[data-theme="dark"] .section.card:focus-within{
  transform: translateY(-2px);
  box-shadow: 0 8px 22px rgba(0,0,0,0.40), 0 2px 8px rgba(0,0,0,0.28);
  border-color: #2a3f66; /* subtle indigo-leaning border for dark */
}

/* =========================
 * Reduced motion
 * ========================= */
@media (prefers-reduced-motion: reduce){
  .section.card{ transition: none; }
  html[data-theme="light"] .section.card:hover,
  html[data-theme="light"] .section.card:focus-within,
  html[data-theme="dark"] .section.card:hover,
  html[data-theme="dark"] .section.card:focus-within{
    transform: none; box-shadow: none;
  }
}

/* =====================================================
 * Consent-attention overrides (placed AFTER theme rules)
 * Ensure pale yellow background in LIGHT theme even if
 * global light .help styles set gray backgrounds.
 * ===================================================== */
html[data-theme="light"] #trial-consent-wrap.consent-attn .help{
  background:
    linear-gradient(180deg, rgba(255, 251, 235, .92) 0%, rgba(254, 243, 199, .98) 100%),
    #fffbeb !important; /* pale yellow */
  border-color: #ef4444 !important; /* red frame */
}
html[data-theme="light"] #trial-consent-wrap.consent-attn .help:focus-within{
  /* Keep a light focus hint, but do not override the animated box-shadow */
  box-shadow: 0 0 0 3px rgba(239,68,68,.28);
}
html[data-theme="light"] #trial-consent-wrap.consent-attn input[type="checkbox"]{
  accent-color: #ef4444;
}

/* Consent OK — soften visuals and turn checkbox green */
#trial-consent-wrap.consent-ok .help{
  animation: none !important;
}
html[data-theme="light"] #trial-consent-wrap.consent-ok .help{
  background: #f3f4f6 !important;  /* light gray */
  border-color: #e5e7eb !important; /* neutral border by default */
  box-shadow: none !important; /* no persistent ring */
}
html[data-theme="dark"] #trial-consent-wrap.consent-ok .help{
  background: #142037 !important;  /* slightly lighter than dark bg */
  border-color: #27344b !important;
  color: #dbe3ee !important;
  box-shadow: none !important;
}
#trial-consent-wrap.consent-ok input[type="checkbox"]{ accent-color: #22c55e; } /* green */
#trial-consent-wrap.consent-ok input[type="checkbox"]:focus,
#trial-consent-wrap.consent-ok input[type="checkbox"]:focus-visible{
  outline: none !important;
  box-shadow: none !important; /* use container green ring instead */
}
#trial-consent-wrap.consent-ok .help:focus-within{
  box-shadow: 0 0 0 4px rgba(34,197,94,.28) !important;
  border-color: #22c55e !important;
}
html[data-theme="light"] #trial-consent-wrap.consent-ok .help:focus-within{
  outline: 2px solid rgba(34,197,94,.55);
  outline-offset: 2px;
}
html[data-theme="dark"] #trial-consent-wrap.consent-ok .help:focus-within{ box-shadow: 0 0 0 4px rgba(34,197,94,.22) !important; }
/* ---- Toggle Switch (拨码开关) ---- */
.switch{ position:relative; display:inline-block; width:46px; height:26px; }
.switch input{ opacity:0; width:0; height:0; }
.switch-slider{ position:absolute; cursor:pointer; inset:0; background:var(--surface-2); border-radius:999px; transition:.2s ease; box-shadow: inset 0 0 0 1px rgba(0,0,0,.06); }
.switch-slider::before{ content:""; position:absolute; width:22px; height:22px; left:2px; top:2px; background:#fff; border-radius:50%; transition:.2s ease; box-shadow:0 1px 2px rgba(0,0,0,.12); }
.switch input:checked + .switch-slider{ background: var(--primary); }
.switch input:checked + .switch-slider::before{ transform:translateX(20px); }
.switch input:disabled + .switch-slider{ opacity:.5; cursor:not-allowed; }
.switch input:focus-visible + .switch-slider{ box-shadow: var(--ring); }

/* Improve OFF contrast in light theme */
html[data-theme="light"] .switch .switch-slider{ background:#e5e7eb; box-shadow: inset 0 0 0 1px #cbd5e1; }
html[data-theme="light"] .switch:hover .switch-slider{ background:#e2e8f0; box-shadow: inset 0 0 0 1px #cbd5e1; }
html[data-theme="light"] .switch input:checked + .switch-slider{
  background: linear-gradient(180deg, var(--primary) 0%, var(--primary-600) 100%);
  box-shadow: inset 0 -1px 0 rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.24), 0 0 0 1px rgba(37,99,235,.35);
}
html[data-theme="light"] .switch input:checked + .switch-slider::before{
  background:#fff;
  box-shadow: 0 1px 2px rgba(0,0,0,.18);
}

/* ---- Disabled field visual ---- */
.field.disabled{ opacity:.6; pointer-events:none; }

/* ---- Segmented buttons reuse (for 强度) ---- */
#adblock-strength-seg{ display:inline-flex; gap:4px; border-radius:10px; padding:4px; background: var(--surface-2); border:1px solid var(--border); }
#adblock-strength-seg .seg-btn{ appearance:none; border:0; background:transparent; padding:6px 12px; font:inherit; color: var(--muted); cursor:pointer; border-radius:8px; transition: background .15s, color .15s, box-shadow .15s; }
#adblock-strength-seg .seg-btn:hover{ background: rgba(0,0,0,.04); color:#0f172a; }
#adblock-strength-seg .seg-btn[aria-selected="true"],
#adblock-strength-seg .seg-btn.active{ background: var(--primary); color:#fff; box-shadow: 0 1px 2px rgba(0,0,0,.12); }
#adblock-strength-seg .seg-btn:focus-visible{ outline: none; box-shadow: var(--ring); }
#adblock-strength-seg .seg-btn:disabled{ opacity:.5; cursor:not-allowed; }

/* Dark theme adaptations for adblock strength */
html[data-theme="dark"] #adblock-strength-seg{ background:#1a2333; border-color: var(--border); }
html[data-theme="dark"] #adblock-strength-seg .seg-btn{ color:#d7dde7; }
html[data-theme="dark"] #adblock-strength-seg .seg-btn:hover{ background: rgba(255,255,255,.06); color:#fff; }
html[data-theme="dark"] #adblock-strength-seg .seg-btn[aria-selected="true"],
html[data-theme="dark"] #adblock-strength-seg .seg-btn.active{ background: var(--primary-600); color:#fff; }

/* ---- Adblock first row layout (three controls in one line) ---- */
.adblock-row{ display:flex; gap:16px; align-items:end; flex-wrap:wrap; margin-bottom:14px; }
.adblock-row .field{ margin: 0; min-width: 220px; }
.adblock-row .field .label{ margin-bottom: 6px; }
.adblock-row .switch{ transform: translateY(1px); }

/* Per-rule sync button */
.sync-btn{ appearance:none; border:0; background:transparent; color:#5b6b7f; width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; border-radius:6px; cursor:pointer; margin-left:6px; }
.sync-btn:hover{ background: rgba(0,0,0,.05); color:#1f2937; }
.sync-btn:focus-visible{ outline:none; box-shadow: var(--ring); }
.sync-btn[disabled]{ opacity:.45; cursor:not-allowed; }
.sync-btn svg{ width:16px; height:16px; stroke: currentColor; fill:none; }
.sync-btn[data-loading="1"] svg{ animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.adbl-status{ font-size:12px; color:#64748b; margin-left:2px; }
.adbl-status.ok{ color:#059669; }
.adbl-status.err{ color:#b91c1c; }
html[data-theme="dark"] .sync-btn:hover{ background: rgba(255,255,255,.06); color:#e6ebf5; }
html[data-theme="dark"] .adbl-status{ color:#9fb0c6; }
html[data-theme="dark"] .adbl-status.ok{ color:#7dd3a7; }
html[data-theme="dark"] .adbl-status.err{ color:#fb7185; }

/* Keep per-row layout stable when status appears */
/* Adblock lists — aligned grid rows */
.checklist{ display:block; }
.checklist label.adbl-row{
  display:grid; grid-template-columns: 20px 1fr 28px 120px; align-items:center; column-gap:10px;
  margin: 6px 0; padding: 0;
}
.checklist label.adbl-row input[type="checkbox"]{ width:16px; height:16px; }
.checklist .adbl-name{ min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.checklist .sync-btn{ width:24px; height:24px; justify-self:start; }
.checklist .adbl-status{ width:120px; display:inline-block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; text-align:left; min-height:1.2em; }

/* Batch summary below each section */
.adbl-summary{ margin-top:6px; font-size:12px; color:#64748b; min-height:1.2em; }
html[data-theme="dark"] .adbl-summary{ color:#9fb0c6; }
/* Sync-all buttons next to section labels */
.sync-all-btn{ appearance:none; border:0; background:transparent; color:#5b6b7f; width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center; border-radius:6px; cursor:pointer; margin-left:8px; vertical-align:middle; }
.sync-all-btn{ position: relative; }
.sync-all-btn:hover{ background: rgba(0,0,0,.05); color:#1f2937; }
.sync-all-btn:focus-visible{ outline:none; box-shadow: var(--ring); }
.sync-all-btn[disabled]{ opacity:.45; cursor:not-allowed; }
.sync-all-btn svg{ width:16px; height:16px; stroke: currentColor; fill:none; }
.sync-all-btn[data-loading="1"] svg{ animation: spin 1s linear infinite; }
html[data-theme="dark"] .sync-all-btn:hover{ background: rgba(255,255,255,.06); color:#e6ebf5; }

/* Custom tooltip for sync-all */
.sync-all-btn:hover::after{ content: attr(data-tip); position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%); background: rgba(17,24,39,.92); color: #f8fafc; padding: 4px 6px; border-radius: 6px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 6px rgba(0,0,0,.2); z-index: 10; }
html[data-theme="light"] .sync-all-btn:hover::after{ background: rgba(0,0,0,.82); color:#fff; }

/* Inline summary near the label button */
.adbl-summary-inline{ margin-left:8px; font-size:12px; color:#64748b; }
html[data-theme="dark"] .adbl-summary-inline{ color:#9fb0c6; }
